name: Sincronizar Dados (DESATIVADO - ETL roda no servidor Oracle Cloud)

# DESATIVADO: O ETL agora Ã© executado por cron no servidor Oracle Cloud (137.131.163.167).
# Este workflow foi mantido como referÃªncia/backup.
# Para reativar, descomente as linhas abaixo.

on:
  # schedule:
  #   - cron: '30 13 * * *'
  #   - cron: '30 18 * * *'
  #   - cron: '30 3 * * *'
  workflow_dispatch:

jobs:
  update-data:
    name: ETL e AtualizaÃ§Ã£o de JSONs (DESATIVADO)
    runs-on: ubuntu-latest
    if: false  # Workflow desativado - ETL roda no servidor Oracle Cloud
    permissions:
      contents: write

    steps:
      - name: 1. Checkout do cÃ³digo
        uses: actions/checkout@v4

      - name: 2. Verificar Node.js
        run: |
          node --version
          npm --version

      - name: 3. Instalar dependÃªncias
        run: npm install

      - name: 4. Rodar ETL (PostgreSQL Sync)
        env:
          SQL_SERVER: ${{ secrets.SQL_SERVER }}
          SQL_USER: ${{ secrets.SQL_USER }}
          SQL_PASSWORD: ${{ secrets.SQL_PASSWORD }}
          SQL_DATABASE: ${{ secrets.SQL_DATABASE }}
          PG_HOST: ${{ secrets.PG_HOST }}
          PG_PORT: ${{ secrets.PG_PORT }}
          PG_USER: ${{ secrets.PG_USER }}
          PG_PASSWORD: ${{ secrets.PG_PASSWORD }}
          PG_DATABASE: ${{ secrets.PG_DATABASE }}
          NODE_OPTIONS: "--max-old-space-size=7168"
        run: node scripts/local-etl/run-sync-v2.js

      - name: 5. FinalizaÃ§Ã£o
        run: |
          echo "âœ… ETL concluÃ­do com sucesso!"
          echo "ðŸ“Š Dados sincronizados no PostgreSQL"
