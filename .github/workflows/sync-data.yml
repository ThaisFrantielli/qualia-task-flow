name: Sincronizar Dados (3x ao Dia)

on:
  schedule:
    - cron: '30 13 * * *'
    - cron: '30 18 * * *'
    - cron: '30 3 * * *'
  workflow_dispatch:

jobs:
  update-data:
    name: ETL e AtualizaÃ§Ã£o de JSONs
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: 1. Checkout do cÃ³digo
        uses: actions/checkout@v4

      - name: 2. Verificar Node.js
        run: |
          node --version
          npm --version

      - name: 3. Instalar dependÃªncias
        run: npm install

      - name: 4. Rodar ETL (PostgreSQL Sync)
        env:
          SQL_SERVER: ${{ secrets.SQL_SERVER }}
          SQL_USER: ${{ secrets.SQL_USER }}
          SQL_PASSWORD: ${{ secrets.SQL_PASSWORD }}
          SQL_DATABASE: ${{ secrets.SQL_DATABASE }}
          PG_HOST: ${{ secrets.PG_HOST }}
          PG_PORT: ${{ secrets.PG_PORT }}
          PG_USER: ${{ secrets.PG_USER }}
          PG_PASSWORD: ${{ secrets.PG_PASSWORD }}
          PG_DATABASE: ${{ secrets.PG_DATABASE }}
          NODE_OPTIONS: "--max-old-space-size=7168"
        run: node scripts/local-etl/run-sync-v2.js

      - name: 5. FinalizaÃ§Ã£o
        run: |
          echo "âœ… ETL concluÃ­do com sucesso!"
          echo "ðŸ“Š Dados sincronizados no PostgreSQL"
 
